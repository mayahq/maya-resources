<script type='text/javascript'>
    RED.nodes.registerType("send-message", {
            category: "Maya Resources",
            color: "#8BBDD9",
            defaults: {
                name: {
                    value: ""
                },
                isProfileConfigNode: {
                    value: false
                },
                targetWorkspace: {
                    value: "",
                    required: false
                },
                payloadTypetargetWorkspace: {
                    value: "str"
                },
                data: {
                    value: "",
                    required: false
                },
                payloadTypedata: {
                    value: "json"
                },
                auth: {
                    value: "",
                    required: false
                },
                payloadTypeauth: {
                    value: "class MayaResourcesAuth extends Node {
                    constructor(node, RED, opts) {
                        super(node, RED, {
                            ...opts,
                        });
                    }

                    static schema = new Schema({
                        name: "maya-resources-auth",
                        label: "Maya Resources :: Auth",
                        category: "config",
                        isConfig: true,
                        fields: {},
                        redOpts: {
                            credentials: {
                                key: new fields.Credential({
                                    type: "str",
                                    password: true
                                }),
                            },
                        },
                    });

                    async onMessage(msg, vals) {}
                }
                " },
                waitForResponse: {
                    value: "",
                    required: false
                },
                payloadTypewaitForResponse: {
                    value: "bool"
                },
            },
            inputs: 1,
            outputs: 1,
            icon: "fa-file-code-o.png",
            label: function() {
                return this.name || "send-message"
            },
            paletteLabel: "send-message",
            exportable: true,
            oneditprepare: function() {
                if (this.payloadTypetargetWorkspace === null) {
                    if (this.targetWorkspace === "") {
                        this.payloadTypetargetWorkspace = "date"
                    } else {
                        this.payloadTypetargetWorkspace = "str"
                    }
                } else if (this.payloadTypetargetWorkspace === 'string' || this.payloadTypetargetWorkspace === 'none') {
                    this.payloadTypetargetWorkspace = "str"
                }

                $("#node-input-payloadTypetargetWorkspace").val(this.payloadTypetargetWorkspace)
                $("#node-input-targetWorkspace").typedInput({
                    default: "str",
                    typeField: $("#node-input-payloadTypetargetWorkspace"),
                    types: ["str", "msg", "flow", "global"]
                })
                $("#node-input-targetWorkspace").typedInput("type", this.payloadTypetargetWorkspace)

                if (this.payloadTypedata === null) {
                    if (this.data === "") {
                        this.payloadTypedata = "date"
                    } else {
                        this.payloadTypedata = "json"
                    }
                } else if (this.payloadTypedata === 'string' || this.payloadTypedata === 'none') {
                    this.payloadTypedata = "json"
                }

                $("#node-input-payloadTypedata").val(this.payloadTypedata)
                $("#node-input-data").typedInput({
                    default: "json",
                    typeField: $("#node-input-payloadTypedata"),
                    types: ["json", "msg", "flow", "global"]
                })
                $("#node-input-data").typedInput("type", this.payloadTypedata)

                if (this.payloadTypeauth === null) {
                    if (this.auth === "") {
                        this.payloadTypeauth = "date"
                    } else {
                        this.payloadTypeauth = "class MayaResourcesAuth extends Node {
                        constructor(node, RED, opts) {
                            super(node, RED, {
                                ...opts,
                            });
                        }

                        static schema = new Schema({
                            name: "maya-resources-auth",
                            label: "Maya Resources :: Auth",
                            category: "config",
                            isConfig: true,
                            fields: {},
                            redOpts: {
                                credentials: {
                                    key: new fields.Credential({
                                        type: "str",
                                        password: true
                                    }),
                                },
                            },
                        });

                        async onMessage(msg, vals) {}
                    }
                    "
                }
            } else if (this.payloadTypeauth === 'string' || this.payloadTypeauth === 'none') {
                this.payloadTypeauth = "class MayaResourcesAuth extends Node {
                constructor(node, RED, opts) {
                    super(node, RED, {
                        ...opts,
                    });
                }

                static schema = new Schema({
                    name: "maya-resources-auth",
                    label: "Maya Resources :: Auth",
                    category: "config",
                    isConfig: true,
                    fields: {},
                    redOpts: {
                        credentials: {
                            key: new fields.Credential({
                                type: "str",
                                password: true
                            }),
                        },
                    },
                });

                async onMessage(msg, vals) {}
            }
            "                
        }

        $("#node-input-payloadTypeauth").val(this.payloadTypeauth) $("#node-input-auth").typedInput({
                default: "class MayaResourcesAuth extends Node {
                constructor(node, RED, opts) {
                    super(node, RED, {
                        ...opts,
                    });
                }

                static schema = new Schema({
                    name: "maya-resources-auth",
                    label: "Maya Resources :: Auth",
                    category: "config",
                    isConfig: true,
                    fields: {},
                    redOpts: {
                        credentials: {
                            key: new fields.Credential({
                                type: "str",
                                password: true
                            }),
                        },
                    },
                });

                async onMessage(msg, vals) {}
            }
            ",
            typeField: $("#node-input-payloadTypeauth"),
            types: [null]
        })
    $("#node-input-auth").typedInput("type", this.payloadTypeauth)

    if (this.payloadTypewaitForResponse === null) {
        if (this.waitForResponse === "") {
            this.payloadTypewaitForResponse = "date"
        } else {
            this.payloadTypewaitForResponse = "bool"
        }
    } else if (this.payloadTypewaitForResponse === 'string' || this.payloadTypewaitForResponse === 'none') {
        this.payloadTypewaitForResponse = "bool"
    }

    $("#node-input-payloadTypewaitForResponse").val(this.payloadTypewaitForResponse)
    $("#node-input-waitForResponse").typedInput({
        default: "bool",
        typeField: $("#node-input-payloadTypewaitForResponse"),
        types: ["json", "msg", "flow", "global", "bool"]
    })
    $("#node-input-waitForResponse").typedInput("type", this.payloadTypewaitForResponse)

    },
    oneditsave: function() {},
        oneditcancel: function() {},
        oneditdelete: function() {},
        oneditresize: function() {},
        onpaletteadd: function() {},
        onpaletteremove: function() {}
    });
</script>

<script type="text/html" data-template-name="send-message">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" style="width:70%;" placeholder="Name" />
    </div>
    <div class="form-row">
        <label for="node-input-targetWorkspace">Target workspace</label>
        <input type="text" id="node-input-targetWorkspace"></input>
        <input type="hidden" id="node-input-payloadTypetargetWorkspace">
    </div>
    <div class="form-row">
        <label for="node-input-data">Data</label>
        <input type="text" id="node-input-data"></input>
        <input type="hidden" id="node-input-payloadTypedata">
    </div>
    <div class="form-row">
        <label for="node-input-auth">Auth</label>
        <input type="text" id="node-input-auth"></input>
        <input type="hidden" id="node-input-payloadTypeauth">
    </div>
    <div class="form-row">
        <label for="node-input-waitForResponse">Wait for response</label>
        <input type="text" id="node-input-waitForResponse"></input>
        <input type="hidden" id="node-input-payloadTypewaitForResponse">
    </div>
</script>

<script type="text/html" data-help-name="send-message">
    <h2>Description</h2>
    <p>The node docs</p>

    <h2>Config</h2>
    <dl class="message-properties">

        <dt>payload<span class="property-type">various</span></dt>
        <dd>The configured payload of the message.</dd>

        <dt class="optional">topic <span class="property-type">string</span></dt>
        <dd>An optional property</dd>

    </dl>


    <h2>Outputs</h2>
    <dl class="message-properties">

        <dt>payload<span class="property-type">various</span></dt>
        <dd>The configured payload of the message.</dd>

        <dt class="optional">topic <span class="property-type">string</span></dt>
        <dd>An optional property</dd>

    </dl>
</script>